@startuml AI心理医生MVP系统架构流程图_v1

skinparam backgroundColor #FEFEFE
skinparam handwritten false
skinparam shadowing false
skinparam defaultFontName "Microsoft YaHei"

title AI心理医生MVP系统架构流程图 (第一版)

' 定义样式
skinparam rectangle {
    BackgroundColor #E3F2FD
    BorderColor #1976D2
    FontColor #0D47A1
}
skinparam database {
    BackgroundColor #FFF3E0
    BorderColor #F57C00
    FontColor #E65100
}
skinparam cloud {
    BackgroundColor #F3E5F5
    BorderColor #7B1FA2
    FontColor #4A148C
}
skinparam agent {
    BackgroundColor #E8F5E9
    BorderColor #388E3C
    FontColor #1B5E20
}

' 用户层
package "用户层" {
    rectangle "Web端应用\n(React + TypeScript)" as WebApp
    rectangle "移动端App\n(React Native)" as MobileApp
    rectangle "微信小程序" as MiniProgram
}

' API网关层
package "API网关层" {
    rectangle "负载均衡" as LoadBalancer
    rectangle "API路由" as APIRouter
    rectangle "限流熔断" as RateLimiter
    rectangle "日志监控" as LogMonitor
}

' 应用服务层
package "应用服务层" {
    rectangle "对话服务\n(ChatService)" as ChatService
    rectangle "情绪识别服务\n(EmotionService)" as EmotionService
    rectangle "评估服务\n(AssessmentService)" as AssessmentService
    rectangle "建议生成服务\n(SuggestionService)" as SuggestionService
    rectangle "预警服务\n(AlertService)" as AlertService
    rectangle "用户服务\n(UserService)" as UserService
}

' AI模型层
package "AI模型层" {
    cloud "对话模型\n(GPT/Claude)" as ChatModel
    cloud "情绪分析模型\n(BERT)" as EmotionModel
    cloud "推荐模型" as RecommendationModel
}

' 数据存储层
package "数据存储层" {
    database "PostgreSQL\n(用户数据、评估数据)" as PostgreSQL
    database "MongoDB\n(对话历史)" as MongoDB
    database "Redis\n(会话状态、缓存)" as Redis
    database "对象存储\n(用户文件、报告)" as ObjectStorage
}

' 连接关系
WebApp --> LoadBalancer
MobileApp --> LoadBalancer
MiniProgram --> LoadBalancer

LoadBalancer --> APIRouter
APIRouter --> RateLimiter
RateLimiter --> LogMonitor

LogMonitor --> ChatService
LogMonitor --> AssessmentService
LogMonitor --> UserService

ChatService --> EmotionService
ChatService --> SuggestionService
ChatService --> AlertService

EmotionService --> EmotionModel
ChatService --> ChatModel
SuggestionService --> RecommendationModel

ChatService --> MongoDB
ChatService --> Redis
AssessmentService --> PostgreSQL
AssessmentService --> MongoDB
UserService --> PostgreSQL
AlertService --> PostgreSQL
AlertService --> MongoDB

note right of ChatService
  - 创建对话会话
  - 发送消息
  - 获取历史记录
end note

note right of EmotionService
  - 识别6种基本情绪
  - 识别复合情绪
  - 判断情绪强度
end note

note right of AssessmentService
  - PHQ-9抑郁评估
  - GAD-7焦虑评估
  - PSS-10压力评估
end note

note right of SuggestionService
  - 情绪调节建议
  - 认知调整建议
  - 行为激活建议
  - 压力管理建议
end note

note right of AlertService
  - 一级预警(紧急)
  - 二级预警(高危)
  - 三级预警(关注)
end note

@enduml
